---
export interface Props {
  slug: string;
}

const { slug } = Astro.props;
---

<script
  src="https://utteranc.es/client.js"
  repo="Nomango/blog"
  issue-term={`[${slug}]`}
  label="âœ¨ðŸ’¬âœ¨"
  theme="github-light"
  crossorigin="anonymous"
  async></script>

<script>
  function changeUtterancesTheme(theme: "github-dark" | "github-light") {
    if (document.querySelector(".utterances-frame")) {
      const message = {
        type: "set-theme",
        theme: theme,
      };
      const iframe = document.querySelector(
        ".utterances-frame"
      ) as HTMLIFrameElement;
      try {
        iframe?.contentWindow?.postMessage(message, "https://utteranc.es");
      } catch {}
    }
  }

  window.addEventListener("message", (e: any) => {
    if (e.origin !== "https://utteranc.es") return;
    if (e.data && e.data.type === "resize") {
      // reset theme
      changeUtterancesTheme(
        document.firstElementChild?.getAttribute("data-theme") === "dark"
          ? "github-dark"
          : "github-light"
      );
    }
  });

  document.addEventListener(
    "themechange",
    (e: CustomEvent<"light" | "dark">) => {
      changeUtterancesTheme(
        e.detail === "dark" ? "github-dark" : "github-light"
      );
    }
  );
</script>
